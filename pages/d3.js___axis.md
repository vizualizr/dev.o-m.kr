date-created:: [[2025-11-10]]
date-modified::
division:: [[makr]]
stack:: frontend
tags:: 
type::
status:: [[ai-proofed]]

- ## Summary
	- logseq.order-list-type:: number
	  #+BEGIN_IMPORTANT
	  **모든 축은 스케일의 표현형이다.**
	  #+END_IMPORTANT
	- “The axis generator is a function that constructs the elements composing an axis.” ([Meeks, 2024, p. 122](zotero://select/library/items/VHTGXJRT)) ([pdf](zotero://open-pdf/library/items/FGBNWKIT?page=148&annotation=FHEYIKAI))
	  logseq.order-list-type:: number
	- 따라서 d3.js에서 축을 그릴 때는 먼저 Scale을 생성하고 이를 바탕으로 축을 그릴 수 있는 함수 객체를 생성한 후 이를 Selection 객체에 전달한다. 전달에는 `selection.call(function, ...arguments) `를 사용한다.
	- EN
		- **Axis is a phenotype of scale.**
		- Therefore, in D3.js, drawing an axis involves first creating a scale, then generating a function object that renders the axis based on the given scale, and finally applying it to a selection object.  To hand over the function object to render *axis*, use `selection.call(function, ...arguments) `
- ## Steps
	- 아래 코드를 예시로 설명한다.
		- ```js
		    const maxTemp = d3.max(data, (d) => d.max_temp_F);
		    const yScale = d3.scaleLinear().domain([0, maxTemp]).range([innerHeight, 0]);
		  
		    // 4. Construct a bottomAxis with the populated xScale.
		    //
		    const bottomAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b"));
		    const leftAxis = d3.axisLeft(yScale);
		    chart.append("g").attr("class", "axis-x").call(bottomAxis);
		  ```
	- 스케일 함수 객체 생성
	  logseq.order-list-type:: number
		- 선형스케일을 생성한다. `yScale`은 입력값을 스케일 변환하는 함수 객체이다.
		  logseq.order-list-type:: number
	- 해당 스케일 함수 객체에 따라 축을 그릴 수 있는 함수 객체 `leftAxis`를 생성한다.
	  logseq.order-list-type:: number
	- `Selection` 객체는 임의의 함수를 호출해 이를 선택된 DOM 요소에 적용하는 `call()` 메서드가 있다. 따라서 `<g>`에서 `call()`로 `bottomAxis`를 호출하면 `<g>` 안에 축을 그린다.
	  logseq.order-list-type:: number
		- 아래는 d3가 그리는 [축의 기본 구조](https://d3js.org/d3-axis)이다.
		  logseq.order-list-type:: number
		- logseq.order-list-type:: number
		  ```html
		  <g fill="none" font-size="10" font-family="sans-serif" text-anchor="middle">
		    <path class="domain" stroke="currentColor" d="M0.5,6V0.5H880.5V6"></path>
		    <g class="tick" opacity="1" transform="translate(0.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">0.0</text>
		    </g>
		    <g class="tick" opacity="1" transform="translate(176.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">0.2</text>
		    </g>
		    <g class="tick" opacity="1" transform="translate(352.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">0.4</text>
		    </g>
		    <g class="tick" opacity="1" transform="translate(528.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">0.6</text>
		    </g>
		    <g class="tick" opacity="1" transform="translate(704.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">0.8</text>
		    </g>
		    <g class="tick" opacity="1" transform="translate(880.5,0)">
		      <line stroke="currentColor" y2="6"></line>
		      <text fill="currentColor" y="9" dy="0.71em">1.0</text>
		    </g>
		  </g>
		  ```
	- EN
		- Create Scale function object.
		  logseq.order-list-type:: number
			- A linear scale is created. `yScale` is a function object that transforms input values according to the defined scale.
			  
			  logseq.order-list-type:: number
		- Create an axis-rendering function object `leftAxis` based on the scale function object.
		  logseq.order-list-type:: number
		- A `Selection` object has a `.call()` method that invokes arbitrary functions and applies them to the selected DOM elements. Thus, calling `bottomAxis` via `.call()` on a  element renders the axis inside that group.
		  logseq.order-list-type:: number
- ## Troubleshooting
	- `call()`은 자바스크립트의 `Function.prototype.call()`이 아니다.
		- `call()` is not `Function.prototype.call()`in JavaScript.
	- [[2025-12-03]] Aligning Date to the base unit
		- If the given date or time isn't aligned with the start of its base unit, the function resets it to the beginning to ensure ticks start correctly.
		- 주어진 날짜가 해당 단위의 첫 시작점이 아닌 경우, 강제로 시작점을 설정하는 방법이다.
		- “First, we note that the x-axis has labels for the months of February to December, which is great, except it doesn’t have one for January. Depending on the time zone in which you live, the first date might not be exactly the first of January at midnight, which prevents D3 from recognizing it as the start of our first month. Because our dataset isn’t dynamic, hardcoding the firstDate variable is a reasonable solution. To do so, we’ll use the JavaScript Date() constructor.”
		  주어진 범위값이 정확히 1월 1일부터 시작하지 않아서 1월 레이블은 건너 뛴다. 즉 레이블을 추가할 때 해당 단위의 시작값이 데이터 범위 안에 있어야 해당 단위의 레이블을 추가하는 형식이다. 예를 들어 스케일의 눈금(tick)을 표시하는 단위가 달(month)이라면 1월 1일의 가장 첫 시간인 자정이 Scale 객체의 range (정의역) 안에 포함되어 있어야 1월 tick을 표시한다.
		- ```js
		    // 3. Preparing the x, y scales to use them in x, y axis
		    //
		    // this is to enforce the first tick starting from January.
		    const firstDateRaw = d3.min(data, (d) => d.date);
		    const firstDate = new Date(firstDateRaw.getFullYear(), 0, 1, 0, 0, 0);
		    const lastDate = d3.max(data, (d) => d.date);
		    // then the scale is as below.
		    const xScale = d3
		      .scaleTime()
		      .domain([firstDateRaw, lastDate])
		      .range([0, innerWidth]);
		  
		  ```
	- [[2025-12-23]] How to style axes
		- [Styled axes / D3 | Observable](https://observablehq.com/@d3/styled-axes)
		- ```js
		  chart = {
		    const width = 928;
		    const height = 500;
		    const marginTop = 20;
		    const marginRight = 0;
		    const marginBottom = 30;
		    const marginLeft = 0;
		  
		    const x = d3.scaleUtc()
		        .domain([new Date("2010-08-01"), new Date("2012-08-01")])
		        .range([marginLeft, width - marginRight]);
		  
		    const y = d3.scaleLinear()
		        .domain([0, 2e6])
		        .range([height - marginBottom, marginTop]);
		  
		    // The format function for y-axis tick labels first converts the given
		    // value to millions (dividing by 1e6 = 1,000,000), then converts to
		    // fixed-point notation with a single decimal digit. By testing 
		    // this.parentNode.nextSibling, the function can special-case the topmost
		    // tick label to give the units; the remaining ticks have a preceding non-
		    // breaking space (\xa0) so that the numbers align with the dollar sign.
		    function formatTick(d) {
		      const s = (d / 1e6).toFixed(1);
		      return this.parentNode.nextSibling ? `\xa0${s}` : `$${s} million`;
		    }
		  
		    const svg = d3.create("svg")
		        .attr("width", width)
		        .attr("height", height)
		        .attr("viewBox", [0, 0, width, height])
		        .attr("style", "max-width: 100%; height: auto;");
		  
		    // The x-axis domain path is removed, since it will overlap with the y 
		    // = 0 tick line. The x axis is translated vertically to place it at the
		    // bottom of the chart area. We’re also using a fancy time format that 
		    // shows ticks for every three months, but only labels the years.
		    svg.append("g")
		        .attr("transform", `translate(0,${height - marginBottom})`)
		        .call(d3.axisBottom(x)
		            .ticks(d3.utcMonth.every(3))
		            .tickFormat(d => d <= d3.utcYear(d) ? d.getUTCFullYear() : null))
		        .call(g => g.select(".domain")
		            .remove());
		  
		    // The y axis is right-oriented (d3.axisRight), but the tick size is
		    // the inner width of the chart area (width - marginLeft - marginRight)
		    // thus placing the tick labels on the left margin. As with the x axis,
		    // the domain path is removed. All of the tick lines except the first
		    // (for y = 0) are given a partially-transparent dashed stroke. Lastly,
		    // the tick labels are repositioned so they sit on top of the tick lines
		    // rather than hanging (invisibly) outside of the chart.`
		    svg.append("g")
		        .attr("transform", `translate(${marginLeft},0)`)
		        .call(d3.axisRight(y)
		            .tickSize(width - marginLeft - marginRight)
		            .tickFormat(formatTick))
		        .call(g => g.select(".domain")
		            .remove())
		        .call(g => g.selectAll(".tick:not(:first-of-type) line")
		            .attr("stroke-opacity", 0.5)
		            .attr("stroke-dasharray", "2,2"))
		        .call(g => g.selectAll(".tick text")
		            .attr("x", 4)
		            .attr("dy", -4));
		  
		    return svg.node();
		  }
		  ```
- ## log
	- [[2025-11-10]] Page created.
	- [[2025-12-23]]
- ### References
	- [d3-axis](https://d3js.org/d3-axis)
	- [selection.call(function, ...arguments)](https://d3js.org/d3-selection/control-flow#selection_call)